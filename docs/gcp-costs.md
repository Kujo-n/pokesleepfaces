# GCP (Firebase) コスト見積もり資料

このドキュメントは、本プロジェクトで使用する Google Cloud Platform (Firebase) のサービスに関するコスト構造、無料枠、および運用規模別の見積もりをまとめたものです。

## 1. 利用サービス概要

本プロジェクトでは以下のサービスを主に使用します。

| サービス | 用途 | 課金モデル |
|----------|------|------------|
| **Firebase Authentication** | ユーザー認証 (Google Sign-In) | 月間アクティブユーザー (MAU) |
| **Cloud Firestore** | データベース (ユーザーデータ保存) | 読み取り/書き込み/削除回数 + ストレージ容量 |
| **Firebase Hosting** | 静的サイトホスティング (Vercel利用時は不要) | データ転送量 + ストレージ容量 |

※ 本プロジェクトは **Blazeプラン (従量課金)** へのアップグレードを推奨しますが、小規模であれば **Sparkプラン (無料)** でも運用可能です。

---

## 2. 無料枠 (Free Tier)

Google Cloud / Firebase は寛大な無料枠を提供しています。個人の趣味開発や小規模な運用であれば、ほぼ無料で利用可能です。

### Cloud Firestore
| 項目 | 無料枠 (Spark & Blaze) | 超過後の料金 (Blaze) |
|------|------------------------|----------------------|
| **書き込み** | 20,000 回 / 日 | $0.18 / 100,000 回 |
| **読み取り** | 50,000 回 / 日 | $0.06 / 100,000 回 |
| **削除** | 20,000 回 / 日 | $0.02 / 100,000 回 |
| **保存容量** | 1 GiB | $0.18 / GiB / 月 |

### Firebase Authentication (Identity Platform)
| 項目 | 無料枠 | 超過後の料金 |
|------|--------|--------------|
| **MAU (Google/Email)** | 50,000 ユーザー / 月 | $0.0055 / ユーザー (50k~100k時) |

※ Identity Platform にアップグレードしない従来の Firebase Auth の場合、電話認証以外は基本的に無料です。

---

## 3. コスト試算シミュレーション

### シナリオ A: 個人開発・小規模運用 (無料枠内)
- **ユーザー数**: 100人 (DAU: 20人)
- **1人あたりの操作**: 1日20クリック (寝顔登録)
- **データ量**: 1ユーザーあたり 10KB

**見積もり: $0 / 月**
- 書き込み: 20人 × 20回 = 400回/日 (無料枠 20,000回以下)
- 読み取り: 20人 × 50回(同期含む) = 1,000回/日 (無料枠 50,000回以下)
- ストレージ: 100人 × 10KB = 1MB (無料枠 1GB以下)

### シナリオ B: 中規模運用 (アクティブなコミュニティ)
- **ユーザー数**: 5,000人 (DAU: 1,000人)
- **1人あたりの操作**: 1日30クリック
- **データ量**: 1ユーザーあたり 50KB

**見積もり: 約 $1.62 / 月**

1. **書き込みコスト**:
   - 1,000人 × 30回 = 30,000回/日
   - 超過分: 10,000回/日 × 30日 = 300,000回/月
   - 料金: 3 × $0.18 = **$0.54**

2. **読み取りコスト**:
   - 1,000人 × 100回(同期・リスト表示) = 100,000回/日
   - 超過分: 50,000回/日 × 30日 = 1,500,000回/月
   - 料金: 15 × $0.06 = **$0.90**

3. **ストレージコスト**:
   - 5,000人 × 50KB = 250MB (無料枠内)
   - 料金: **$0**

### シナリオ C: 大規模運用 (人気アプリ化)
- **ユーザー数**: 50,000人 (DAU: 10,000人)
- **1人あたりの操作**: 1日50クリック

**見積もり: 約 $65 / 月**

1. **書き込み**:
   - 10,000人 × 50回 = 500,000回/日
   - 月間: 1,500万回
   - 料金: 150 × $0.18 = **$27.00**

2. **読み取り**:
   - 10,000人 × 200回 = 2,000,000回/日
   - 月間: 6,000万回
   - 料金: 600 × $0.06 = **$36.00**

3. **Authentication**:
   - 50,000 MAU (無料枠ギリギリ)
   - 料金: **$0** (超過した場合は微増)

---

## 4. コスト削減・管理のポイント

### Firestore の最適化
1. **ローカルキャッシュの活用** (実装済み)
   - `enableIndexedDbPersistence` により、2回目以降の読み取り通信を大幅に削減できます。
2. **不要な読み取りの回避**
   - 必要なデータのみを取得するようクエリを設計します。
3. **書き込みの抑制**
   - 頻繁な更新が必要な場合は、デバウンス処理やバッチ書き込みを検討します。

### 予算アラートの設定 (推奨)
Google Cloud Console の「お支払い」セクションから予算アラートを設定することを強く推奨します。
- 例: 「月額 $5 を超えたらメール通知」

### Vercel の利用
フロントエンドのホスティングに Vercel (Hobbyプラン) を利用することで、Firebase Hosting の転送量コストを削減できます。

---

## 5. 結論

本アプリケーションの現在のアーキテクチャと想定される利用規模（個人〜小規模コミュニティ）では、**基本的に無料枠内 ($0)** で運用可能です。
ユーザー数が数千人規模に拡大した場合でも、月額数ドル程度の維持費で済むと予想されます。
